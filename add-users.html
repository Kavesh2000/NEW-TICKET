<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Users to System</title>
</head>
<body>
    <h1>Adding Users to Banking System</h1>
    <div id="status">Processing...</div>

    <script>
        // User data organized by department - CORRECTED ASSIGNMENTS BASED ON USER DATA
        const userData = {
            'IT': [
                'Stevaniah Kavela',
                'Mercy Mukhwana',
                'Eric Mokaya'
            ],
            'Operations': [
                'Caroline Ngugi',
                'Lilian Kimani',
                'Maureen Kerubo',
                'Alice Muthoni',
                'Michael Mureithi'
            ],
            'Finance': [
                'Patrick Ndegwa',
                'Margaret Njeri',
                'Elizabeth Mungai'
            ],
            'Data Analysis': [
                'Stevaniah Kavela'
            ],
            'Customer Service': [
                'Ebby Gesare',
                'Vivian Orisa',
                'Juliana Jeptoo',
                'Faith Bonareri',
                'Patience Mutunga',
                'Eva Mukami',
                'Peter Kariuki'
            ],
            'admin': [
                'Elizabeth Mungai',
                'Ken Okwero',
                'Alice Muthoni'
            ],
            'Security': [
                'Bonface Kioko',
                'Eric Mokaya',
                'Clive Odame'
            ]
        };

        // Function to generate email from name
        function generateEmail(name) {
            return name.toLowerCase().replace(/\s+/g, '.') + '@maishabank.com';
        }

        // Function to generate unique ID
        function generateUserId() {
            return 'U-' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substr(2, 3).toUpperCase();
        }

        // Load existing users
        function loadUsers() {
            return JSON.parse(localStorage.getItem('users') || '[]');
        }

        // Save users
        function saveUsers(users) {
            localStorage.setItem('users', JSON.stringify(users));
        }

        // Add users to system
        function addUsers() {
            const existingUsers = loadUsers();
            const newUsers = [];
            let addedCount = 0;

            // Process each department
            Object.keys(userData).forEach(department => {
                userData[department].forEach(name => {
                    // Check if user already exists (by name and department combination)
                    const existingUser = existingUsers.find(u =>
                        u.name === name && u.role === department
                    );

                    if (!existingUser) {
                        const user = {
                            id: generateUserId(),
                            name: name,
                            email: generateEmail(name),
                            role: department,
                            mfa: false,
                            sso: false,
                            created: new Date().toISOString(),
                            status: 'active'
                        };

                        existingUsers.push(user);
                        newUsers.push(user);
                        addedCount++;
                    }
                });
            });

            // Save updated users list
            saveUsers(existingUsers);

            return { addedCount, newUsers, totalUsers: existingUsers.length };
        }

        // Execute the user addition automatically when page loads
        window.addEventListener('load', function() {
            try {
                const result = addUsers();
                document.getElementById('status').innerHTML = `
                    <h2 style="color: green;">✅ Users Added Successfully!</h2>
                    <p><strong>${result.addedCount}</strong> new users added to the system.</p>
                    <p><strong>Total users in system:</strong> ${result.totalUsers}</p>

                    <h3>New Users Added by Department:</h3>
                    <div style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        ${Object.keys(userData).map(dept => `
                            <div><strong>${dept}:</strong> ${userData[dept].length} users</div>
                        `).join('')}
                    </div>

                    <h3>Sample Users Added:</h3>
                    <ul style="background: #f9f9f9; padding: 10px; border-radius: 5px;">
                        ${result.newUsers.slice(0, 10).map(user =>
                            `<li>${user.name} (${user.role}) - ${user.email}</li>`
                        ).join('')}
                        ${result.newUsers.length > 10 ? `<li>... and ${result.newUsers.length - 10} more users</li>` : ''}
                    </ul>

                    <br>
                    <p style="color: blue;"><strong>Next Steps:</strong></p>
                    <ol>
                        <li>Close this page</li>
                        <li>Go to <a href="users.html" target="_blank">User Management</a> to view all users</li>
                        <li>Login as different departments to test access controls</li>
                    </ol>
                `;
            } catch (error) {
                document.getElementById('status').innerHTML = `
                    <h2 style="color: red;">❌ Error Adding Users</h2>
                    <p>Error: ${error.message}</p>
                    <p>Please check the browser console for details.</p>
                `;
                console.error('Error adding users:', error);
            }
        });
    </script>
</body>
</html>