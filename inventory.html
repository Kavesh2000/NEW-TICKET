<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management - Bank System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>[data-module]:not(.visible){display:none !important;}</style>
    <style>
        body {
            background: #F8FAFC;
            min-height: 100vh;
        }
    </style>
</head>
<body class="text-gray-800">
    <header class="bg-blue-900 py-4">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-white">Inventory Management Module</h1>
            <nav class="mt-4">
                <a href="index.html" class="mr-4 hover:underline text-white">Home</a>
                <a href="#" id="logout" class="hover:underline text-white">Logout</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Access Control -->
        <div id="accessDenied" class="hidden text-center py-12">
            <i class="fas fa-lock text-6xl text-red-500 mb-4"></i>
            <h2 class="text-3xl font-bold text-gray-900 mb-2">Access Denied</h2>
            <p class="text-gray-600">Inventory Management is available for authorized departments only.</p>
            <p class="text-gray-600">For assistance, contact <a href="mailto:automation@maishabank.com" class="text-teal-600 hover:underline">automation@maishabank.com</a></p>
            <a href="system.html" class="mt-4 inline-block bg-teal-600 text-white px-6 py-2 rounded-lg">Back to Dashboard</a>
        </div>

        <div id="inventoryContent">
        <h2 class="text-3xl font-bold mb-6 text-center text-gray-900">IT Inventory Management</h2>

        <div class="grid md:grid-cols-3 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="text-xl font-bold mb-4 text-gray-900">Total Items</h3>
                <p class="text-3xl font-bold text-blue-600" id="totalItems">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="text-xl font-bold mb-4 text-gray-900">Hardware</h3>
                <p class="text-3xl font-bold text-green-600" id="hardwareCount">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="text-xl font-bold mb-4 text-gray-900">Software</h3>
                <p class="text-3xl font-bold text-purple-600" id="softwareCount">0</p>
            </div>
        </div>

        <div class="flex gap-2 mb-6">
            <button id="btnAddItem" class="bg-teal-600 text-white px-4 py-2 rounded">Add Item</button>
            <button id="btnExportInventory" class="bg-gray-200 px-4 py-2 rounded">Export CSV</button>
        </div>

        <div class="grid md:grid-cols-5 gap-4 mb-4">
            <input id="filterName" placeholder="Filter by name" class="px-3 py-2 border rounded-md">
            <select id="filterCategory" class="px-3 py-2 border rounded-md">
                <option value="">All Categories</option>
                <option value="Hardware">Hardware</option>
                <option value="Software">Software</option>
                <option value="Accessories">Accessories</option>
            </select>
            <input id="filterLocation" placeholder="Filter by location" class="px-3 py-2 border rounded-md">
            <input id="filterSupplier" placeholder="Filter by supplier" class="px-3 py-2 border rounded-md">
            <button id="btnSearchInventory" class="bg-teal-600 text-white px-4 py-2 rounded">Search</button>
        </div>

        <div id="inventoryContainer" class="space-y-4">
            <!-- Inventory items will be loaded here -->
        </div>
        <p id="noInventory" class="text-center mt-8 text-gray-700">No inventory items found.</p>
        </div>
    </main>

    <footer class="bg-blue-900 py-4 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-white">&copy; 2026 Onit Microfinance Bank. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Check access
        const userDept = localStorage.getItem('userDept');
        if (!userDept || !hasModuleAccess('inventory','read')) {
            document.getElementById('accessDenied').classList.remove('hidden');
            document.getElementById('inventoryContent').classList.add('hidden');
        } else {
            document.getElementById('accessDenied').classList.add('hidden');
            document.getElementById('inventoryContent').classList.remove('hidden');
            document.getElementById('inventoryContent').classList.add('visible');
        }

        document.getElementById('logout').addEventListener('click', function(){ localStorage.removeItem('userDept'); window.location.href='index.html'; });

        // Inventory data storage
        const STORAGE_INVENTORY = 'inventory';

        function loadInventory() {
            return JSON.parse(localStorage.getItem(STORAGE_INVENTORY) || '[]');
        }

        function saveInventory(items) {
            localStorage.setItem(STORAGE_INVENTORY, JSON.stringify(items));
        }

        function formatItemRow(item) {
            return `
                <div class="bg-white p-4 rounded shadow">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-bold">${item.name}</div>
                            <div class="text-sm text-gray-600">Category: ${item.category} • Location: ${item.location || 'N/A'} • Quantity: ${item.quantity}</div>
                            <div class="text-sm text-gray-600">Status: ${item.status} • Supplier: ${item.supplier || 'N/A'} • Cost: $${item.cost || 'N/A'}</div>
                            ${item.serialNumber ? `<div class="text-sm text-gray-600">Serial: ${item.serialNumber}</div>` : ''}
                            ${item.model ? `<div class="text-sm text-gray-600">Model: ${item.model}</div>` : ''}
                            ${item.version ? `<div class="text-sm text-gray-600">Version: ${item.version}</div>` : ''}
                            ${item.licenseKey ? `<div class="text-sm text-gray-600">License: ${item.licenseKey}</div>` : ''}
                            <div class="text-sm text-gray-500">${item.description || ''}</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editItem('${item.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">Edit</button>
                            <button onclick="deleteItem('${item.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm">Delete</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderInventory(filters = {}) {
            const all = loadInventory();
            let items = all.slice();

            if (filters.name) items = items.filter(i => i.name.toLowerCase().includes(filters.name.toLowerCase()));
            if (filters.category) items = items.filter(i => i.category === filters.category);
            if (filters.location) items = items.filter(i => (i.location || '').toLowerCase().includes(filters.location.toLowerCase()));
            if (filters.supplier) items = items.filter(i => (i.supplier || '').toLowerCase().includes(filters.supplier.toLowerCase()));

            const container = document.getElementById('inventoryContainer');
            if (!items.length) {
                document.getElementById('noInventory').style.display = 'block';
                container.innerHTML = '';
            } else {
                document.getElementById('noInventory').style.display = 'none';
                container.innerHTML = items.map(formatItemRow).join('');
            }

            updateStats();
        }

        function updateStats() {
            const items = loadInventory();
            document.getElementById('totalItems').textContent = items.length;
            document.getElementById('hardwareCount').textContent = items.filter(i => i.category === 'Hardware').length;
            document.getElementById('softwareCount').textContent = items.filter(i => i.category === 'Software').length;
        }

        document.getElementById('btnSearchInventory').addEventListener('click', () => {
            renderInventory({
                name: document.getElementById('filterName').value,
                category: document.getElementById('filterCategory').value,
                location: document.getElementById('filterLocation').value,
                supplier: document.getElementById('filterSupplier').value
            });
        });

        document.getElementById('btnAddItem').addEventListener('click', () => {
            const name = prompt('Item name:');
            if (!name) return;

            const category = prompt('Category (Hardware/Software/Accessories):', 'Hardware');
            const quantity = parseInt(prompt('Quantity:', '1')) || 1;
            const location = prompt('Location:');
            const status = prompt('Status (Available/In Use/Maintenance/Retired/Disposed):', 'Available');
            const supplier = prompt('Supplier:');
            const cost = parseFloat(prompt('Cost:', '0')) || 0;
            const description = prompt('Description:');

            let serialNumber, model, version, licenseKey;

            if (category === 'Hardware') {
                serialNumber = prompt('Serial Number:');
                model = prompt('Model:');
            } else if (category === 'Software') {
                version = prompt('Version:');
                licenseKey = prompt('License Key:');
            }

            const items = loadInventory();
            const newItem = {
                id: Date.now().toString(),
                name,
                category,
                quantity,
                location,
                status,
                supplier,
                cost,
                description,
                serialNumber,
                model,
                version,
                licenseKey,
                created: new Date().toISOString()
            };
            items.push(newItem);
            saveInventory(items);
            renderInventory();
        });

        function editItem(id) {
            const items = loadInventory();
            const item = items.find(i => i.id === id);
            if (!item) return;

            const name = prompt('Item name:', item.name);
            if (!name) return;

            item.name = name;
            item.category = prompt('Category:', item.category);
            item.quantity = parseInt(prompt('Quantity:', item.quantity)) || 1;
            item.location = prompt('Location:', item.location);
            item.status = prompt('Status:', item.status);
            item.supplier = prompt('Supplier:', item.supplier || '');
            item.cost = parseFloat(prompt('Cost:', item.cost || 0)) || 0;
            item.description = prompt('Description:', item.description || '');

            if (item.category === 'Hardware') {
                item.serialNumber = prompt('Serial Number:', item.serialNumber || '');
                item.model = prompt('Model:', item.model || '');
                item.version = undefined;
                item.licenseKey = undefined;
            } else if (item.category === 'Software') {
                item.version = prompt('Version:', item.version || '');
                item.licenseKey = prompt('License Key:', item.licenseKey || '');
                item.serialNumber = undefined;
                item.model = undefined;
            } else {
                item.serialNumber = undefined;
                item.model = undefined;
                item.version = undefined;
                item.licenseKey = undefined;
            }

            saveInventory(items);
            renderInventory();
        }

        function deleteItem(id) {
            if (!confirm('Delete this item?')) return;
            const items = loadInventory();
            const filtered = items.filter(i => i.id !== id);
            saveInventory(filtered);
            renderInventory();
        }

        document.getElementById('btnExportInventory').addEventListener('click', () => {
            const items = loadInventory();
            if (!items.length) {
                alert('No inventory items to export');
                return;
            }
            const csv = ['id,name,category,quantity,location,status,supplier,cost,serialNumber,model,version,licenseKey,description,created', ...items.map(i => `${i.id},"${i.name}","${i.category}",${i.quantity},"${i.location || ''}","${i.status}","${i.supplier || ''}",${i.cost || 0},"${i.serialNumber || ''}","${i.model || ''}","${i.version || ''}","${i.licenseKey || ''}","${i.description || ''}","${i.created}"`)]].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'inventory.csv';
            a.click();
            URL.revokeObjectURL(url);
        });

        // Initial render
        renderInventory();
    </script>
</body>
</html>